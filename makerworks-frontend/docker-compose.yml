services:
  # ------------------------
  # Frontend Dev (Vite hot reload)
  # ------------------------
  frontend-dev:
    build:
      context: ./makerworks-frontend
      dockerfile: Dockerfile
      target: dev
    container_name: makerworks_frontend_dev
    restart: unless-stopped
    ports:
      - "5173:5173"
    env_file:
      - .env
    environment:
      # Your app hits the API at the backend; thumbnails are served by backend at /thumbnails
      VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:8000/api/v1}
      VITE_THUMB_BASE_URL: ${VITE_THUMB_BASE_URL:-http://localhost:8000/thumbnails}
    volumes:
      - ./makerworks-frontend:/app
      - /app/node_modules
      # (Optional) Mount the host thumbnails into the dev container too, in case you want to peek at them here.
      - /Users/stephenchartrand/Downloads/makerworks-repo/makerworks/thumbnails:/thumbnails:rw
    command: npm run dev -- --host

  # ------------------------
  # Frontend Production (Nginx)
  # ------------------------
  frontend-prod:
    build:
      context: ./makerworks-frontend
      dockerfile: Dockerfile
      target: production
    container_name: makerworks_frontend_prod
    restart: unless-stopped
    ports:
      - "80:80"
    env_file:
      - .env
    environment:
      VITE_API_BASE_URL: ${VITE_API_BASE_URL:-http://localhost:8000/api/v1}
      # not strictly used at runtime, but keeps env symmetry with dev
      VITE_THUMB_BASE_URL: ${VITE_THUMB_BASE_URL:-/thumbnails}
    depends_on:
      backend:
        condition: service_healthy
    volumes:
      # serve the built app
      - ./makerworks-frontend/nginx.conf:/etc/nginx/conf.d/default.conf:ro
      # mount the **root thumbnail library** so Nginx can serve /thumbnails directly
      - /Users/stephenchartrand/Downloads/makerworks-repo/makerworks/thumbnails:/thumbnails:ro
